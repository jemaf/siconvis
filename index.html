<!doctype html>
<html>
      <head>
          <meta charset="utf-8">
          <meta http-equiv="x-ua-compatible" content="ie=edge">
          <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

          <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
          <link type="text/css" rel="stylesheet" href="css/materialize.css"  media="screen,projection"/>
          <link type="text/css" rel="stylesheet" href="css/main.css">
          <title>SICONVIS</title>
      </head>
      <body>

        <nav class="indigo darken-4" role="navigation">
          <div class="nav-wrapper container"><a id="logo-container" href="#" class="brand-logo">DCC/UFMG</a>
            <ul class="right hide-on-med-and-down">
              <li><a href="#">Visualização de Dados</a></li>
            </ul>
          </div>
        </nav>



        <div id="index-banner" class="parallax-container" style="filter: brightness(50%);">
          <div class="section no-pad-bot">
            <div class="container">
              <br><br>
              <div class="row center">
                <h3 class="header col s12 light">How does the government is investing on your state?</h3>
              </div>
              <div class="row center">
                  <div class="input-field col s12">
                    <div class="card white">
                      <i id="search-icon" class="material-icons prefix">search</i>
                      <input id="search" type="text" placeholder="eg.: MG, RS, SP, RR, RO, etc...">
                    </div>
                  </div>
              </div>
              <br><br>

            </div>
          </div>
          <div class="parallax"><img src="img/background.jpg" alt="Unsplashed background img 1"></div>
        </div>


  
        <div class="container">
          <div class="section">
            <div class="row">
              <div class="col m4 s12">
                <div class="card-panel">  
                  <img id="state-flag" class="responsive-img" src="" alt="">
                  <h5 id="state-name"></h5>
                  <span><b>Capital: </b><span id="state-capital"></span></span><br>
                  <span><b>Region: </b><span id="state-region"></span></span><br>
                  <span><b>Population: </b><span id="state-population"></span></span><br>
                </div>
              </div>
              <div class="col m4 s12">
                <div class="card-panel grey lighten-4">
                  <p>Number of cities attended</p>
                  <h5 id="total-cities-label"></h5>
                  <div id="stack-total-cities"></div>
                </div>
                <div class="card-panel grey lighten-4">
                  <p>Number of agreements approved</p>
                  <h5 id="total-programs-label"></h5>
                  <div id="stack-total-programs"></div>
                </div>
              </div>  
              <div class="col m4 s12">
                <div id="radar"></div>
              </div>  
            </div>
            <div class="row">
              <div class="col s12">
                <div id="stack-investments-total"></div>
              </div>
            </div>
            <div class="row">
              <div class="col m6 s12">
                <div id="stack-investments-counterpart"></div>
              </div>
              <div class="col m6 s12">
                <div id="stack-investments-state"></div>
              </div>
            </div>
          </div>  
        </div>

        <footer class="page-footer indigo">
        <div class="container">
          <div class="row">
            <div class="col l8 s12">
              <h5 class="white-text">About</h5>
              <p class="grey-text text-lighten-4">
                Os dados deste trabalho foram coletados do Portal de Convênios do Governo Federal (SICONV), sendo portanto de uso público, conforme estipulado na Lei de Acesso à Informação (Lei nº 12.527 de 2011).
              </p>
            </div>
            <div class="col l4 s12">
              <h5 class="white-text">Integrantes</h5>
              <ul>
                <li><a class="white-text" href="http://jemaf.github.io">João Eduardo Montandon</a></li>
                <li><a class="white-text" href="#!">José Laerte Xavier</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="footer-copyright">
          <div class="container">
          Made by <a class="indigo-text text-lighten-3" href="http://materializecss.com">Materialize</a>
          </div>
        </div>
        </footer>
       
        <script src="js/vendor/d3.min.js"></script>
        <script src="js/vendor/alasql.min.js"></script>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="js/vendor/materialize.js"></script>

        
        <script src="js/constants.js"></script>
        <script src="js/data.js"></script>
        <script src="js/radar.js"></script>
        <script src="js/stacked.js"></script>


        
        <script type="text/javascript" charset="utf-8"> 
          $('.parallax').parallax();

          function loadData2(data, stateId) {
            if (stateId == undefined || stateId == "" || stateId == "BR") {
              var filteredRadarData = getRadarData(data);
              var filteredStackedData = handleData(data);
              var filteredStackedCitiesData = getCityData(data);
              var filteredStackedProgramData = getProgramData(data);

              stateId = "BR";
            } 

            var state = STATES_DATA[stateId];
            if (state) {
              if (stateId != "BR") {
                var filteredRadarData = getRadarData(data, stateId);
                var filteredStackedData = handleData(data);
                var filteredStackedCitiesData = getCityData(data, stateId);
                var filteredStackedProgramData = getProgramData(data, stateId);
              }

              $(STATE_NAME_TEXT).text(state.name);
              $(STATE_CAPITAL_TEXT).text(state.capital);
              $(STATE_REGION_TEXT).text(state.region);
              $(STATE_POPULATION_TEXT).text(state.population);
              $(STATE_FLAG).attr("src", "img/" + stateId + ".png");  
              $(TOTAL_CITIES_TEXT).text(filteredStackedCitiesData.total);
              $(TOTAL_PROGRAMS_TEXT).text(filteredStackedProgramData.total);

              if (stateId != "BR")
                $(STATE_REGION_TEXT).parent().show();
              else 
                $(STATE_REGION_TEXT).parent().hide();
            }
          }

        
          loadData(function(err, data) {
        
            colorRange = ["#015eff", "#0cc402", "#aea7a5", "#d21170", "#d99f07", "#11a5fe", "#037e43", "#ba4455", "#d10aff", "#9354a6", "#7b6d2b", "#08bbbb", "#95b42d", "#b54e04", "#ee74ff", "#2d7593", "#e19772", "#fa7fbe", "#aea0db", "#905e76", "#92b27a", "#03c262", "#878aff", "#4a7662", "#07b6e5", "#fe8504", "#9340e1"];

            $(SEARCH_BUTTON).bind("enterKey",function(e){
              loadData2(data, e.currentTarget.value);
            });

            $(SEARCH_BUTTON).keyup(function(e){
              if(e.keyCode == 13)
                $(this).trigger("enterKey");
            });

            loadData2(data);
              
            var radarData = getRadarData(data);
            var stackedData = handleData(data);
            var stackedCitiesData = getCityData(data);
            var stackedProgramData = getProgramData(data);
              
            $(TOTAL_CITIES_TEXT).text(stackedCitiesData.total);
            $(TOTAL_PROGRAMS_TEXT).text(stackedProgramData.total);

            radar = radarChart();

            radar()
                .container(RADAR_CONTAINER)
                .margin({top: 70, right: 70, bottom: 70, left: 70})
                .width(200)
                .height(200)
                .data(radarData.items)
                .color(d3.scale.ordinal().range(colorRange))
                .maxValue(0.30)
                .levels(5)
                .roundStrokes(true)
                .draw();

            stackInvestmentsTotal = stackedChart();
            stackInvestmentsCounterpart = stackedChart();
            stackInvestmentsState = stackedChart();
            stackCities = stackedChart();
            stackPrograms = stackedChart();

            stackInvestmentsTotal
                .container(STACK_INVESTMENTS_TOTAL_CONTAINER)
                .margin({top: 20, right: 30, bottom: 30, left: 40})
                .width(960)
                .height(250)
                .data(stackedData)
                .color(d3.scale.ordinal().range(colorRange))
                .xAxis({ orientation: "bottom", ticks: d3.time.years })
                .yAxis({ orientation: "left" })
                .nestKey("uf")
                .draw();

            stackInvestmentsCounterpart
                .container(STACK_INVESTMENTS_COUNTERPART_CONTAINER)
                .margin({top: 20, right: 30, bottom: 30, left: 40})
                .width(450)
                .height(200)
                .data(stackedData)
                .color(d3.scale.ordinal().range(colorRange))
                .xAxis({ orientation: "bottom", ticks: d3.time.years })
                .yAxis({ orientation: "left" })
                .nestKey("uf")
                .draw();

            stackInvestmentsState
                .container(STACK_INVESTMENTS_STATE_CONTAINER)
                .margin({top: 20, right: 30, bottom: 30, left: 40})
                .width(450)
                .height(200)
                .data(stackedData)
                .color(d3.scale.ordinal().range(colorRange))
                .xAxis({ orientation: "bottom", ticks: d3.time.years })
                .yAxis({ orientation: "left" })
                .nestKey("uf")
                .draw();

            stackCities
                .container(STACK_TOTAL_CITIES_CONTAINER)
                .margin({top: 0, right: 0, bottom: 0, left: 0})
                .width(200)
                .height(50)
                .data(stackedCitiesData.items)
                .color(d3.scale.ordinal().range(colorRange))
                .xAxis({ orientation: "bottom", ticks: d3.time.years, tickSize: 0 })
                .yAxis({ orientation: "left", tickSize: 0 })
                .nestKey("uf")
                .draw();


            stackPrograms
                .container(STACK_TOTAL_PROGRAMS_CONTAINER)
                .margin({top: 0, right: 0, bottom: 0, left: 0})
                .width(200)
                .height(50)
                .data(stackedProgramData.items)
                .color(d3.scale.ordinal().range(colorRange))
                .xAxis({ orientation: "bottom", ticks: d3.time.years, tickSize: 0 })
                .yAxis({ orientation: "left", tickSize: 0 })
                .nestKey("uf")
                .draw();
          });
        </script>
    </body>
</html>
